<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Troubleshooting pxweb R package • pxweb</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="deps/bs3compat-0.3.1/transition.js"></script><script src="deps/bs3compat-0.3.1/tabs.js"></script><script src="deps/bs3compat-0.3.1/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><link href="syntax-highlighting.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="Troubleshooting pxweb R package"><meta property="og:image" content="https://ropengov.github.io/pxweb/logo.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@rOpenGov"><meta name="twitter:site" content="@rOpenGov"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet"><!-- rogtemplate style sheet --><link href="rogtemplate.css" rel="stylesheet"></head><body data-spy="scroll" data-target="#toc" data-headroom>
    

      <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    <a class="navbar-brand mb-0 h1" href="index.html">pxweb</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="">0.12.0</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3"><li class="nav-item">
  <a class="nav-link" href="articles/pxweb.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control mr-sm-2" aria-label="Search" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search..." autocomplete="off"></form>

      <ul class="navbar-nav ml-1"><li class="nav-item">
  <a class="nav-link" href="https://github.com/rOpenGov/pxweb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <div class="contents col-md-9">
    <img src="logo.png" class="pkg-logo" alt=""><div class="page-header pb-2 mt-4 mb-2 border-bottom toc-ignore}">
      <h1 class="display-4">Troubleshooting pxweb R package</h1>
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/pxweb/blob/master/TROUBLESHOOTING.md"><code>TROUBLESHOOTING.md</code></a></small>
    </div>

<div id="troubleshooting-pxweb-r-package" class="section level1">

<div id="encoding-errors-on-windows" class="section level2">
<h2 class="hasAnchor">
<a href="#encoding-errors-on-windows" class="anchor" aria-hidden="true"></a>Encoding errors on Windows</h2>
<div id="date-added" class="section level3">
<h3 class="hasAnchor">
<a href="#date-added" class="anchor" aria-hidden="true"></a>Date added:</h3>
<p>2021-07-07</p>
</div>
<div id="versions" class="section level3">
<h3 class="hasAnchor">
<a href="#versions" class="anchor" aria-hidden="true"></a>Versions</h3>
<p>This problem exist in pxweb version 0.10 +. This is only a problem on Windows.</p>
</div>
<div id="description" class="section level3">
<h3 class="hasAnchor">
<a href="#description" class="anchor" aria-hidden="true"></a>Description</h3>
<p>On windows, some letters are not encoded correctly. For example, in R or Rstudio the UTF-8 coding is not preserved during assignment. For instance:</p>
<pre><code>x &lt;- "ČETRTLETJE"
x
[1] "CETRTLETJE"</code></pre>
<p>This means that when a UTF-8 encoding is used in a query explicitly, the package will not find the variable name and hence will return something like:</p>
<pre><code>Assertion on 'pxweb_query_variable_code' failed: Must be element of set {'KOHEZIJSKA REGIJA','DRŽAVA ROJSTVA','SPOL','CETRTLETJE','MERITVE'}, but is 'CETRTLETJE'.</code></pre>
</div>
<div id="workaround" class="section level3">
<h3 class="hasAnchor">
<a href="#workaround" class="anchor" aria-hidden="true"></a>Workaround</h3>
<p>To fix this, explicitly referenced the offending character using the escape sequence as:</p>
<pre><code>pxweb_query_list &lt;- 
  list("KOHEZIJSKA REGIJA"=c("0"),
       "DRŽAVA ROJSTVA"=c("0"),
       "SPOL"=c("0"),
       "MERITVE"=c("2000"))
       
# Explicit encoding ČETRTLETJE
fixed_name &lt;- paste("\U010C", "ETRTLETJE", sep = "")
years &lt;- c("2008Q1","2008Q2")
pxweb_query_list[[fixed_name]] &lt;- years

pxdata &lt;- pxweb_get(url, pxweb_query_list)</code></pre>
<p>To find the specific encoding for your special letter, see: <a href="https://www.fileformat.info/info/unicode/char/search.htm" class="external-link uri">https://www.fileformat.info/info/unicode/char/search.htm</a></p>
</div>
<div id="more-info" class="section level3">
<h3 class="hasAnchor">
<a href="#more-info" class="anchor" aria-hidden="true"></a>More info</h3>
<p><a href="https://github.com/rOpenGov/pxweb/issues/217" class="external-link uri">https://github.com/rOpenGov/pxweb/issues/217</a></p>
</div>
</div>
<div id="error-running-pxweb-in-parallel" class="section level2">
<h2 class="hasAnchor">
<a href="#error-running-pxweb-in-parallel" class="anchor" aria-hidden="true"></a>Error: Running pxweb in parallel</h2>
<div id="date-added-1" class="section level3">
<h3 class="hasAnchor">
<a href="#date-added-1" class="anchor" aria-hidden="true"></a>Date added:</h3>
<p>2021-07-07</p>
</div>
<div id="versions-1" class="section level3">
<h3 class="hasAnchor">
<a href="#versions-1" class="anchor" aria-hidden="true"></a>Versions</h3>
<p>This problem exist in pxweb version 0.8+.</p>
</div>
<div id="description-1" class="section level3">
<h3 class="hasAnchor">
<a href="#description-1" class="anchor" aria-hidden="true"></a>Description</h3>
<p>Currently, the <code>pxweb</code> package is not thread-safe, and hence it is not safe to runt multiple <code>pxweb_get</code> functions in parallel or in different R sessions from the same computer/IP address.</p>
</div>
<div id="workaround-1" class="section level3">
<h3 class="hasAnchor">
<a href="#workaround-1" class="anchor" aria-hidden="true"></a>Workaround</h3>
<p>Don’t run pxweb in parallel.</p>
</div>
</div>
<div id="error-too-large-query" class="section level2">
<h2 class="hasAnchor">
<a href="#error-too-large-query" class="anchor" aria-hidden="true"></a>Error: Too large query</h2>
<div id="date-added-2" class="section level3">
<h3 class="hasAnchor">
<a href="#date-added-2" class="anchor" aria-hidden="true"></a>Date added:</h3>
<p>2019-02-15</p>
</div>
<div id="versions-2" class="section level3">
<h3 class="hasAnchor">
<a href="#versions-2" class="anchor" aria-hidden="true"></a>Versions</h3>
<p>This problem exist in pxweb version 0.8+.</p>
</div>
<div id="description-2" class="section level3">
<h3 class="hasAnchor">
<a href="#description-2" class="anchor" aria-hidden="true"></a>Description</h3>
<p>In some situation (some PXWEB APIS) it is possible to get an <code>Error: Too large query</code> error message (can look a little bit different for different pxweb versions) if a large query is done. The reason for this problem is that the pxweb R package cannot split the query into chunks/batches with a size smaller than the maximum values limit for the API.</p>
<p>All PXWEB APIs table objects have dimension and/or content variables. Content variables are only one variable and indicate what contents to download (such as the number of inhabitants and the percentage change in inhabitants). It is not always so that content variables exist in a PXWEB table. To split up a large query, only dimension variables can be split into smaller chunks (they are the rows in the PX-DATA object). So the pxweb R package tries to identify what variables that are dimension variables by checking if the variable can be eliminated or if the variable is the time variable. So if a variable is not time and cannot be eliminated it is not possible to be sure that the variable is not a content variable, and then the variable cannot be used to split the query.</p>
<p>This will hopefully be solved by the PXWEB API provider supplying information if the variable is a content variable or not in future releases.</p>
</div>
<div id="workaround-2" class="section level3">
<h3 class="hasAnchor">
<a href="#workaround-2" class="anchor" aria-hidden="true"></a>Workaround</h3>
<p>The only way to solve this currently is to manually specify variables that the pxweb package can use to split up the query by setting the variables elimination to <code>TRUE</code> that are not content variables. Below is a working example of a workaround.</p>
<pre><code>url &lt;- "http://px.hagstofa.is/pxis/api/v1/is/Efnahagur/utanrikisverslun/1_voruvidskipti/03_inntollskra/UTA03801.px"
pxweb_query_list &lt;- list("Tollskrárnúmer" = c("*"),
                         "Land" = c("AF", "AL"),           
                         "Mánuður" = c("2016M01"),
                         "Eining" = c("*"))
pxq &lt;- pxweb_query(pxweb_query_list)
px_data &lt;- pxweb_get(url, pxq)
Error: Too large query

# Variable(s) Tollskrárnúmer, Eining cannot be split to batches (eliminate is FALSE).

# We download the metadata object and set eliminate to TRUE 
# (since Eining is not a content variable)
pxmd &lt;- pxweb_get(url)
pxmd$variables[[4]]$elimination &lt;- TRUE

# We explicitly supply the meta data object to use for downloading
px_data &lt;- pxweb_advanced_get(url, pxq, pxmdo = pxmd)

Downloading large query (in 4 batches):
  |==================================================================| 100%

px_data

PXWEB DATA
With 5 variables and 35792 observations.</code></pre>
<p>Another example is:</p>
<pre><code><a href="https://github.com/rOpenGov/pxweb/" class="external-link">library(pxweb)
pxweb_query_list &lt;- list("Typ av psykisk hälsa"=c("*"),
                         "Andel och konfidensintervall"=c("2"),
                         "Ålder"=c("16-29","30-44","45-64","65-84"),
                         "Kön"=c("1","2"),
                         "År"=c("2018","2016","2015",
                                "2014","2013","2012",
                                "2011","2010","2009",
                                "2008","2007","2006",
                                "2005","2004"))
url &lt;- "http://fohm-app.folkhalsomyndigheten.se/Folkhalsodata/api/v1/sv/B_HLV/dPsykhals/HLV_Psykisk_halsa_alder.px"

# We get the error that no variables can be split up. 
px_data &lt;- pxweb_get(url = url,
                     query = pxweb_query_list)

# We download the metadata object and set eliminate to TRUE for 
# one variable that is not a content variable.
# Here variable 1 ('Typ av psykisk hälsa') is a variable we can 
# split the batches on since (we know) it is not a content variable.
pxmd &lt;- pxweb_get(url)
pxmd$variables[[1]]$elimination &lt;- TRUE

# We explicitly supply the meta data object to use for downloading
px_data &lt;- pxweb_advanced_get(url, pxweb_query_list, pxmdo = pxmd)

##   Downloading large query (in 2 batches):
## |========================================================| 100%

px_data

## PXWEB DATA
## With 6 variables and 1792 observations.</a></code></pre>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
   <div class="sticky-top">
    <nav id="toc"><h2 data-toc-skip>Contents</h2>

    </nav></div>
  </div>

</div>



      <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Mans Magnusson, Markus Kainu, Janne Huovari, Leo Lahti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer></div>

  

    <!-- Add ropengov logo -->
  <script src="logo.js"></script></body></html>

